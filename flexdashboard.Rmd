---
title: "Newspaper Content Analysis"
author: "Elise Hachfeld and Theresa Worden"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: yeti
runtime: shiny
---
```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidytext)
library(DT)
library(igraph)
library(shinyWidgets)
source("data_prep.R")
source("text_analysis.R")
```

```{r import}
#get_all_years("1941", "1942") commenting out because I don't want to run this every time...
pearl_data <- prepare_data(data = "Data/pearl_data.rds")
```

# About

## Column {data-width="500"}

### Background

By [Elise Hachfeld](https://github.com/elisefeld) and [Theresa Worden](https://github.com/wordentheresa0)

The way people consume media has changed drastically since 1941, but has its content? We are interested in how major historical events affect the sentiment of people reflected in the media. To investigate this, we looked at the text of newspapers 3 months before and after the bombing of Pearl Harbor on December 7th, 1941.

We sourced our data from the Library of Congress [Chronicling America](https://www.loc.gov/collections/chronicling-america/about-this-collection/) project, which contains historical American newspapers from 1756 to 1963.

The data was accessed through the Chronicling America API using the [httr2](https://httr2.r-lib.org) and [jsonlite](https://jeroen.r-universe.dev/jsonlite) packages.

View some more Pearl Harbor front pages [here](https://www.nypl.org/blog/2017/12/07/pearl-harbor-front-page).

## Column {data-width="500"}

```{r picture, echo = F, out.width = '100%'}
knitr::include_graphics("images/pearl_harbor_front_page.png")
```


# Common Words
## Column {data-width="500"}
```{r}
#Add filter here
```

## Column {data-width="500"}
```{r}
words <- tokenize_words(data = pearl_data, text_column = "text_data")
words_clean <- remove_stopwords()

words_clean |>
  head(1000) |>
  DT::datatable(options = list(bPaginate = TRUE)) #Not sure why this isn't showing on the site
```

## Column {data-width="500"}
```{r}
words_clean |>
  slice_max(n, n = 20) |>
  ggplot(aes(fct_reorder(word, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Most Common Words in Front Pages of Newspapers",
       subtitle = "September 7th, 1941 to March 7th, 1942",
       x = "Count",
       y = "Word")

#ggraph(ngram_filter_graph, layout = "fr") +
#  geom_edge_link() +
#  geom_node_point() +
#  geom_node_text(aes(label = name), vjust = 1, hjust = 1)
```


# Section

## Column {data-width="400"}

### Box 1

```{r eruptions, echo=FALSE}
result <- analyze_bing_sentiment(data = words)
bing <- result[[1]]
bing_avg <- result[[2]]

```

### Parameters

```{r}
#Add code for adjusting data here

```

## Column {data-width="300"}

### Box 3

Talk about the graph here.

# Sentiment Analysis

## Row {.tabset .tabset-fade}

### Box 1
```{r, echo=FALSE}
bing <- words |>
  inner_join(bing_sentiments, by = "word")

bing_by_page <- bing |>
  mutate(sentiment_value = ifelse(sentiment == "positive", 1, -1)) |>
  group_by(index) |>
  summarize(avg_sentiment = mean(sentiment_value, na.rm = TRUE)) |>
  arrange(index)
```

```{r}
bing |>
  count(index, sentiment) |>
  pivot_wider(names_from = sentiment, values_from = n, values_fill = 0) |>
  mutate(sentiment = positive - negative) |>
  ggplot(aes(x = index, y = sentiment, fill = sentiment > 0)) +
  geom_col(show.legend = FALSE) +
  theme_minimal() +
  labs(
    x = "index",
    y = "average",
    title = "average sentiment by description"
  )
```

### Box 2

```{r, echo=FALSE}
date_bing <- bing |>
  group_by(index, date) |>
  mutate(sentiment_value = ifelse(sentiment == "positive", 1, -1)) |>
  summarize(avg_sentiment = mean(sentiment_value, na.rm = TRUE), .groups = "drop") |>
  arrange(date)

date_summary <- date_bing |>
  group_by(date) |>
  summarize(avg_sentiment = mean(avg_sentiment, na.rm = TRUE), .groups = "drop")

ggplot(date_summary, aes(x = as.Date(date), y = avg_sentiment, fill = avg_sentiment > 0)) +
  geom_col(show.legend = FALSE) +
  theme_minimal() +
  labs(
    x = "date",
    y = "average sentiment",
    title = "average sentiment by date"
  ) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %d")

print(date_summary$date)
str(bing)
str(date_bing)
head(date_summary)
```

## Row

### Box 3

Talk about the graph here.

### Parameters

```{r}
#Add code for adjusting data here

```

# Section 3

# Section 4
